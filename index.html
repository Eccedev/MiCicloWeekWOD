<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi CicloWeekWOD</title>
    <style>
        :root {
            --bg: #0a0a0c;
            --card: #16161a;
            --primary: #00f2ff;
            --secondary: #7000ff;
            --text: #e1e1e6;
            --muted: #8b8b92;
            --success: #00e676;
            --danger: #ff4d4d;
        }

        body { 
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; 
            background: var(--bg); 
            color: var(--text); 
            margin: 0; 
            padding: 15px; 
            display: flex; 
            flex-direction: column; 
            align-items: center;
            min-height: 100vh;
        }

        .container { max-width: 500px; width: 100%; padding-bottom: 40px; }
        
        /* Header & Progress */
        .header-status { 
            background: var(--card); 
            padding: 20px; 
            border-radius: 20px; 
            margin-bottom: 20px; 
            border: 1px solid #29292e; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .title-app {
            width: 100%; 
            background: #00f2ff; 
            color: #000; 
            border: none; 
            padding: 10px; 
            border-radius: 10px; 
            text-align: center;
            font-size: 2rem; 
            font-weight: 900; 
            margin-top: 10px; 
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .info-row { 
            display: flex; 
            justify-content: space-between; 
            font-weight: 800; 
            font-size: 1.1rem; 
            margin-bottom: 12px; 
            letter-spacing: 1px;
        }

        .progress-container { width: 100%; height: 8px; background: #29292e; border-radius: 4px; overflow: hidden; }
        .progress-bar { 
            height: 100%; 
            background: linear-gradient(90deg, var(--primary), var(--secondary)); 
            border-radius: 4px; 
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); 
        }

        #display-fecha { 
            font-size: 0.8rem; 
            color: var(--muted); 
            text-align: center; 
            margin-top: 15px; 
            text-transform: capitalize; 
        }

        /* WOD Display */
        .day-title { 
            color: var(--primary); 
            text-transform: uppercase; 
            font-size: 0.85rem; 
            letter-spacing: 3px; 
            margin-bottom: 20px; 
            text-align: center; 
            font-weight: 900; 
            text-shadow: 0 0 10px rgba(0, 242, 255, 0.3);
        }

        .ex-card { 
            background: var(--card); 
            border-radius: 18px; 
            padding: 20px; 
            margin-bottom: 15px; 
            border: 1px solid #29292e; 
            transition: transform 0.2s, border-color 0.2s;
        }

        .ex-card:hover { border-color: #3e3e46; }

        .ex-name { font-size: 1.15rem; font-weight: 700; margin-bottom: 10px; color: #fff; }
        
        .ex-details { 
            font-size: 0.85rem; 
            color: var(--muted); 
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .detail-item b { color: var(--text); }

        .ex-load { 
            font-size: 1.8rem; 
            color: var(--success); 
            font-weight: 800; 
            display: flex; 
            align-items: baseline; 
            gap: 6px; 
            padding-top: 10px;
            border-top: 1px solid #29292e;
        }

        .unit { font-size: 0.9rem; color: var(--muted); font-weight: 400; text-transform: uppercase; }

        /* Buttons */
        .btn-finish { 
            width: 100%; 
            background: #fff; 
            color: #000; 
            border: none; 
            padding: 22px; 
            border-radius: 18px; 
            font-size: 1.2rem; 
            font-weight: 900; 
            cursor: pointer;
            margin-top: 10px; 
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .btn-finish:active { transform: scale(0.96); background: var(--success); }

        .reset-zone { margin-top: 40px; text-align: center; }
        .btn-reset { 
            background: none; 
            border: 1px solid #29292e; 
            color: var(--muted); 
            font-size: 0.7rem; 
            padding: 8px 15px; 
            border-radius: 8px; 
            cursor: pointer; 
        }
        .btn-reset:hover { color: var(--danger); border-color: var(--danger); }

        .rest-day { 
            text-align: center; 
            padding: 80px 20px; 
            color: var(--muted); 
            font-style: italic;
            line-height: 1.6;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .active-dot {
            height: 8px; width: 8px; background: var(--success); border-radius: 50%;
            display: inline-block; margin-right: 8px; animation: pulse 2s infinite;
        }
    </style>
</head>
<body>

        <h1><span class="title-app">Mi CicloWeekWOD</span></h1>
<div class="container">    
    <!-- Estatus Superior -->
    <div class="header-status">
        <div class="info-row">
            <span>CICLO <span id="display-ciclo">1</span></span>
            <span>SEM <span id="display-semana">1</span><small>/8</small></span>
        </div>
        <div class="progress-container">
            <div id="progress-bar" class="progress-bar"></div>
        </div>
        <div id="display-fecha"></div>
    </div>

    <!-- Título del WOD -->
    <div id="wod-name" class="day-title">Calculando Entrenamiento...</div>

    <!-- Lista de Ejercicios -->
    <div id="wod-container"></div>

    <!-- Botón de Acción -->
    <button id="main-btn" class="btn-finish" onclick="completarWod()">FIN WOD ✅</button>

    <!-- Zona de Reseteo (Oculta/Pequeña) -->
    <div class="reset-zone">
        <button class="btn-reset" onclick="resetApp()">RESETEAR PROGRESO TOTAL</button>
    </div>
</div>

<script>
    /**
     * CONFIGURACIÓN DE RUTINA (Punto 5)
     * pBase: Peso en KG
     * rBase: Resistencia (1.0 a 100.0)
     */
    const RUTINA = {
        0: { nombre: "Domingo: Descanso Total", ejercicios: [] },
        1: { nombre: "Lunes: Torso A (Empuje)", ejercicios: [
            { n: "Press banca plano", s: 3, r: 8, pBase: 30, d: "3'" },
            { n: "Press banca inclinado 45º", s: 3, r: 10, pBase: 30, d: "2'" },
            { n: "Jalón alto a pecho", s: 3, r: 10, pBase: 20, d: "2'" },
            { n: "Elevaciones laterales", s: 3, r: 12, pBase: 5.0, d: "1'" },
            { n: "Tríceps", s: 3, r: 12, pBase: 10.0, d: "1'" }
        ]},
        2: { nombre: "Martes: Piernas A (Anterior)", ejercicios: [
            { n: "Sentadillas traseras", s: 3, r: 8, pBase: 30, d: "3'" },
            { n: "Cinturón ruso", s: 3, r: 10, pBase: 6, d: "2'" },
            { n: "Leg curl prono", s: 3, r: 12, pBase: 4, d: "1'" },
            { n: "Elevar talones de pie", s: 3, r: 12, pBase: 30.0, d: "1'" },
            { n: "Abs: Planchas y Curl", s: 3, r: 12, rBase: 2.0, d: "1'" }
        ]},
        3: { nombre: "Miércoles: Recuperación Activa", ejercicios: [
            { n: "Caminar paso ligero", s: 1, r: "1h", rBase: 1.0, d: "-" }
        ]},
        4: { nombre: "Jueves: Torso B (Tracción)", ejercicios: [
            { n: "Remo 45º", s: 3, r: 8, pBase: 20, d: "3'" },
            { n: "Press banca declinado", s: 3, r: 10, pBase: 30, d: "2'" },
            { n: "Remo bajo gironda", s: 3, r: 12, pBase: 20, d: "1'" },
            { n: "Press militar", s: 3, r: 10, pBase: 20, d: "2'" },
            { n: "Curl bíceps barra", s: 3, r: 12, pBase: 20.0, d: "1'" }
        ]},
        5: { nombre: "Viernes: Piernas B (Posterior)", ejercicios: [
            { n: "Peso muerto rumano", s: 3, r: 8, pBase: 30, d: "3'" },
            { n: "Sentadilla búlgara", s: 3, r: 10, pBase: 4, d: "2'" },
            { n: "Hip Trust-Subir puente", s: 3, r: 10, pBase: 20, d: "2'" },
            { n: "Elevar talones de pie", s: 3, r: 12, pBase: 4, d: "1'" },
            { n: "Abs: Elevación piernas", s: 3, r: 12, rBase: 2.0, d: "1'" }
        ]},
        6: { nombre: "Sábado: Recuperación Activa", ejercicios: [
            { n: "Bicicleta estática", s: 1, r: "1h", rBase: 1.0, d: "-" }
        ]}
    };

    let estado = {
        ciclo: parseInt(localStorage.getItem('pt_ciclo')) || 1,
        semana: parseInt(localStorage.getItem('pt_semana')) || 1
    };

    /**
     * Calcula la progresión basada en las reglas del usuario
     */
    function calcularCarga(ex, sem, ciclo) {
        let base = ex.pBase !== undefined ? ex.pBase : ex.rBase;
        let unidad = ex.pBase !== undefined ? "kg" : "Res.";
        
        if (base === 0) return "--";

        // Lógica Punto 4: Inicio de ciclo basado en Semana 4 del anterior
        let cargaInicioCiclo = base;
        if (ciclo > 1) {
            for (let i = 1; i < ciclo; i++) {
                // El ciclo hereda la progresión acumulada hasta la semana 4 (3 incrementos)
                cargaInicioCiclo *= Math.pow(1.02, 3);
            }
        }

        let valorFinal;
        if (sem == 8) {
            // Semana 8: Descarga (80% de la semana 7)
            let pesoSem7 = cargaInicioCiclo * Math.pow(1.02, 6);
            valorFinal = (pesoSem7 * 0.8).toFixed(1);
        } else {
            // Incremento semanal del 2%
            valorFinal = (cargaInicioCiclo * Math.pow(1.02, sem - 1)).toFixed(1);
        }

        return `${valorFinal} <span class="unit">${unidad}</span>`;
    }

    function render() {
        const fechaActual = new Date();
        const hoy = fechaActual.getDay(); // 0=Dom, 1=Lun...
        const wod = RUTINA[hoy];
        
        // Actualizar Cabecera
        document.getElementById('display-ciclo').innerText = estado.ciclo;
        document.getElementById('display-semana').innerText = estado.semana;
        document.getElementById('wod-name').innerHTML = `<span class="active-dot"></span>${wod.nombre}`;
        document.getElementById('display-fecha').innerText = fechaActual.toLocaleDateString('es-ES', { 
            weekday: 'long', day: 'numeric', month: 'long' 
        });
        
        // Barra de Progreso
        const porcentaje = (estado.semana / 8) * 100;
        document.getElementById('progress-bar').style.width = `${porcentaje}%`;

        const container = document.getElementById('wod-container');
        const btn = document.getElementById('main-btn');
        container.innerHTML = '';

        if (wod.ejercicios.length === 0) {
            container.innerHTML = `
                <div class="rest-day">
                    <p>Hoy es día de recuperación total.</p>
                    <small>La disciplina también implica saber descansar.</small>
                </div>`;
            btn.style.display = 'none';
            return;
        }

        btn.style.display = 'block';
        wod.ejercicios.forEach(ex => {
            container.innerHTML += `
                <div class="ex-card">
                    <div class="ex-name">${ex.n}</div>
                    <div class="ex-details">
                        <div class="detail-item">Series: <b>${ex.s}</b></div>
                        <div class="detail-item">Reps: <b>${ex.r}</b></div>
                        <div class="detail-item">Descanso: <b>${ex.d}</b></div>
                        <div class="detail-item">Tipo: <b>${ex.pBase !== undefined ? 'Pesas' : 'Tensión'}</b></div>
                    </div>
                    <div class="ex-load">${calcularCarga(ex, estado.semana, estado.ciclo)}</div>
                </div>
            `;
        });
    }

    function completarWod() {
        const hoy = new Date().getDay();
        
        // Mensaje de éxito
        const msgs = ["¡Excelente trabajo!", "Un paso más cerca del objetivo.", "Disciplina de hierro.", "¡WOD superado!"];
        const randomMsg = msgs[Math.floor(Math.random() * msgs.length)];

        // Si es fin de semana (Viernes, Sábado o Domingo), sugerimos avanzar semana
        if (hoy === 5 || hoy === 6 || hoy === 0) {
            if (confirm(`${randomMsg}\n\n¿Deseas finalizar la Semana ${estado.semana} y pasar a la siguiente?`)) {
                if (estado.semana < 8) {
                    estado.semana++;
                } else {
                    estado.semana = 1;
                    estado.ciclo++;
                    alert("¡CICLO COMPLETADO! Iniciando nuevo bloque de 8 semanas con cargas superiores.");
                }
            }
        } else {
            alert(randomMsg);
        }

        // Guardar estado
        localStorage.setItem('pt_ciclo', estado.ciclo);
        localStorage.setItem('pt_semana', estado.semana);
        render();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function resetApp() {
        if (confirm("¿Seguro que quieres borrar todo el progreso y volver al Ciclo 1, Semana 1?")) {
            localStorage.clear();
            estado.ciclo = 1;
            estado.semana = 1;
            render();
        }
    }

    // Inicializar
    render();
</script>

</body>
</html>
